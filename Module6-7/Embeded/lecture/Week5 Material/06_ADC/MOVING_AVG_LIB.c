/*
*************************** C SOURCE FILE ************************************

project   :
filename  : CTEMPLATE.C
version   : 2
date      :

******************************************************************************

Copyright (c) 20xx
All rights reserved.

******************************************************************************

VERSION HISTORY:
----------------------------
Version      : 1
Date         :
Revised by   :
Description  :

Version      : 2
Date         :
Revised by   :
Description  : *
               *
               *

******************************************************************************
*/

#define MOVING_AVG_LIB_C_SRC

/****************************************************************************/
/**                                                                        **/
/**                             MODULES USED                               **/
/**                                                                        **/
/****************************************************************************/

#include "MOVING_AVG_LIB.H"

/****************************************************************************/
/**                                                                        **/
/**                        DEFINITIONS AND MACROS                          **/
/**                                                                        **/
/****************************************************************************/


/****************************************************************************/
/**                                                                        **/
/**                        TYPEDEFS AND STRUCTURES                         **/
/**                                                                        **/
/****************************************************************************/


/****************************************************************************/
/**                                                                        **/
/**                      PROTOTYPES OF LOCAL FUNCTIONS                     **/
/**                                                                        **/
/****************************************************************************/


/****************************************************************************/
/**                                                                        **/
/**                           EXPORTED VARIABLES                           **/
/**                                                                        **/
/****************************************************************************/


/****************************************************************************/
/**                                                                        **/
/**                            GLOBAL VARIABLES                            **/
/**                                                                        **/
/****************************************************************************/


/****************************************************************************/
/**                                                                        **/
/**                           EXPORTED FUNCTIONS                           **/
/**                                                                        **/
/****************************************************************************/

void InitMvgAvg (MOVING_AVG_STRUCT *mvgPtr, APP_DAT_TYPE *arrayPtr,
				 APP_DAT_TYPE arrayLng)

{
	APP_DAT_TYPE i;
	mvgPtr->sum = 0;
	mvgPtr->avg = 0;
	mvgPtr->put = 0;
	mvgPtr->buffLength = arrayLng;
	mvgPtr->buffPtr = arrayPtr;
	for (i = 0; i< arrayLng ;i++)
	{
		arrayPtr[i] = 0;
	}
	return;
}

void MovingAvg (MOVING_AVG_STRUCT *mvgPtr, APP_DAT_TYPE newDat,
				APP_DAT_TYPE *resultPtr)
{
	mvgPtr->sum = mvgPtr->sum - mvgPtr->buffPtr[mvgPtr->put] + newDat;
	mvgPtr->avg = mvgPtr->sum / mvgPtr->buffLength;
	if ((mvgPtr->sum % mvgPtr->buffLength) >= (mvgPtr->buffLength / 2))
	{
		mvgPtr->avg = mvgPtr->avg + 1;
	}
	*resultPtr = mvgPtr->avg + 1;
	mvgPtr->sum = mvgPtr->sum - newDat + mvgPtr->avg;
	mvgPtr->buffPtr[mvgPtr->put] = mvgPtr->avg;
	mvgPtr->put ++;
	if (mvgPtr->put == mvgPtr->buffLength)
	{
		mvgPtr->put = 0;
	}
	return;
}	

/****************************************************************************/
/**                                                                        **/
/**                             LOCAL FUNCTIONS                            **/
/**                                                                        **/
/****************************************************************************/

/****************************************************************************/

/****************************************************************************/
/**                                                                        **/
/**                                 EOF                                    **/
/**                                                                        **/
/****************************************************************************/